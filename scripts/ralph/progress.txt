## Codebase Patterns
- Workspace uses `edition.workspace = true` and `rust-version.workspace = true` to inherit from root
- Crate directory structure: `crates/<name>/Cargo.toml` + `crates/<name>/src/lib.rs`
- Dependency chain: pdfplumber → {pdfplumber-core, pdfplumber-parse}, pdfplumber-parse → pdfplumber-core
- pdfplumber-core has zero external dependencies (pure algorithms)
- Quality checks: `cargo fmt --all -- --check && cargo clippy --workspace -- -D warnings && cargo test --workspace && cargo check --workspace`
- CJK detection: `is_cjk(char)` / `is_cjk_text(&str)` in `text.rs` — covers 11 Unicode blocks
- TextDirection enum (Ltr/Rtl/Ttb/Btt) in `text.rs` — controls sorting and gap logic in WordExtractor
- CJK tolerance pattern: use `last_char.bbox.width().max(base_tolerance)` for horizontal, `.height()` for vertical
- Geometric primitives: `Point(x, y)` and `Ctm(a, b, c, d, e, f)` in `geometry.rs`
- CTM transform: `(x', y') = (a*x + c*y + e, b*x + d*y + f)` — row-vector convention
- PathBuilder stores CTM-transformed coordinates; current_point is always in device space
- `v` operator uses already-transformed current_point as cp1 (no double transform)
- `re` operator delegates to move_to/line_to/close_path for consistent CTM handling
- Shape extraction: `extract_shapes(painted, page_height) -> (Vec<Line>, Vec<Rect>, Vec<Curve>)` in `shapes.rs`
- Curve: 4-point (start, cp1, cp2, end) in top-left origin; bbox from control points
- Edge derivation: `edges.rs` — `edge_from_line`, `edges_from_rect` (4 edges), `edge_from_curve` (chord)
- `derive_edges(lines, rects, curves) -> Vec<Edge>` — combines all sources with EdgeSource tracking
- Page holds geometry: `with_geometry()` constructor, `lines()/rects()/curves()/edges()` accessors
- Image extraction: `image_from_ctm(ctm, name, page_height, metadata) -> Image` in `images.rs`
- Image bbox from CTM: transform unit square corners (0,0),(1,0),(0,1),(1,1) through CTM, find bounding box, y-flip
- Page holds images: `with_geometry_and_images()` constructor (8 args, #[allow(clippy::too_many_arguments)])
- Encoding tables: `static [Option<char>; 256]` in const blocks, `StandardEncoding` enum for lookup
- FontEncoding: base table + Differences override via `apply_differences(&[(u8, char)])`
- EncodingResolver: 3-level chain — ToUnicode (HashMap<u16, String>) > FontEncoding > default
- ImageMetadata: src_width, src_height, bits_per_component, color_space — all Optional
- y-flip: `top_origin_y = page_height - pdf_y` for coordinate conversion
- Rect detection: axis-aligned closed 4-vertex subpath OR 5-vertex where last==first
- Line extraction: only from stroked paths (fill-only non-rects produce nothing)
- ClosePath generates a closing Line segment back to subpath start if start != current
- DashPattern: `dash_array: Vec<f64>`, `dash_phase: f64`; solid = empty array; `is_solid()` check
- GraphicsState extended: `dash_pattern`, `stroke_alpha`, `fill_alpha` alongside line_width/colors
- ExtGState: all-Optional struct applied via `GraphicsState::apply_ext_gstate()` — only overrides present fields
- `d` operator: `GraphicsState::set_dash_pattern(array, phase)` — inline dash pattern setting
- PaintedPath captures dash_pattern + alpha from GraphicsState at paint time
- Painting refactored: private `paint()` helper avoids 9× struct literal duplication
- Layout pipeline: words → lines (y-proximity) → split at columns (x-gaps) → blocks (x-overlap + y-proximity) → reading order (top, x0)
- `split_lines_at_columns()`: splits TextLines at gaps > x_density between consecutive words
- `cluster_lines_into_blocks()`: x-overlap-aware — line must overlap block's x-range to join it
- `sort_blocks_reading_order()`: simple (top, x0) sort — handles single/multi-column naturally
- `words_to_text()` for simple mode; `blocks_to_text()` for layout mode (blocks separated by \n\n)
- TextOptions: layout (bool), y_tolerance, y_density, x_density — all with sensible defaults
---

# Ralph Progress Log - Phase 2: Words & Geometry - Word Grouping, Path Extraction, Reading Order
Started: 2026년  2월 27일 금요일 23시 36분 31초 KST
---

## 2026-02-27 - US-018: WordExtractor - tolerance-based character grouping
- **What was implemented:**
  - `BBox` type in `crates/pdfplumber-core/src/geometry.rs` — bounding box with top-left origin (x0, top, x1, bottom), with union/width/height methods
  - `Char` type in `crates/pdfplumber-core/src/text.rs` — character with text, bbox, fontname, size
  - `WordOptions` struct with pdfplumber-compatible defaults (x_tolerance=3, y_tolerance=3, keep_blank_chars=false, use_text_flow=false)
  - `Word` struct with text, bbox (union of char bboxes), and constituent chars
  - `WordExtractor::extract()` — groups chars into words by spatial proximity with sorting, space handling, and tolerance-based grouping
- **Files changed:**
  - `crates/pdfplumber-core/src/lib.rs` — module declarations and re-exports
  - `crates/pdfplumber-core/src/geometry.rs` (new) — BBox type
  - `crates/pdfplumber-core/src/text.rs` (new) — Char type
  - `crates/pdfplumber-core/src/words.rs` (new) — Word, WordOptions, WordExtractor + 21 unit tests
- **Dependencies added:** None (pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - Keep modules flat (geometry.rs, text.rs, words.rs) rather than nested — simpler and matches crate convention
  - `BBox::union()` is the key primitive for composing bounding boxes — will be reused across many features
  - Word extraction gap check: `x_gap = next.x0 - prev.x1`, new word if `> x_tolerance` or `y_diff > y_tolerance`
  - Sorting by (top, x0) before grouping handles out-of-order chars from PDF content streams
---

## 2026-02-27 - US-019: Page::extract_words() API + Word type integration
- **What was implemented:**
  - `Page` struct in `crates/pdfplumber/src/page.rs` — holds page metadata (page_number, width, height) and extracted chars
  - `Page::new()` constructor, accessor methods: `page_number()`, `width()`, `height()`, `chars()`
  - `Page::extract_words(&self, options: &WordOptions) -> Vec<Word>` — delegates to `WordExtractor::extract()`
  - Public re-exports from `crates/pdfplumber/src/lib.rs`: `Page`, `BBox`, `Char`, `Word`, `WordExtractor`, `WordOptions`
  - 9 unit tests covering: page creation, chars access, word extraction with default/custom options, text concatenation, bbox calculation, multiline, empty page, constituent chars
- **Files changed:**
  - `crates/pdfplumber/src/page.rs` (new) — Page type + 9 tests
  - `crates/pdfplumber/src/lib.rs` — added page module, public re-exports
- **Dependencies added:** None
- **Learnings for future iterations:**
  - The pdfplumber facade crate re-exports core types so users only need `use pdfplumber::{Page, WordOptions}`
  - Page is constructed from pre-extracted chars; actual PDF parsing will feed chars into Page later
  - Test modules within the facade crate need explicit `use pdfplumber_core::BBox` since `super::*` only imports from the module scope, not the crate re-exports
---

## 2026-02-27 - US-020: CJK word grouping - character-width-based tolerance
- **What was implemented:**
  - `TextDirection` enum (Ltr, Rtl, Ttb, Btt) in `crates/pdfplumber-core/src/text.rs`
  - `is_cjk(char)` and `is_cjk_text(&str)` functions covering 11 Unicode blocks (CJK Unified, Hiragana, Katakana, Hangul, Bopomofo, etc.)
  - CJK-aware tolerance in `WordExtractor`: uses `char.bbox.width()` as tolerance for CJK chars instead of fixed `x_tolerance`
  - Vertical text support: `TextDirection::Ttb/Btt` — sorts columns right-to-left, uses `y_gap` and char height as tolerance
  - `text_direction` field added to `WordOptions` (default: Ltr, backward-compatible)
  - Helper methods: `effective_x_tolerance()`, `effective_y_tolerance()`, `should_split_horizontal()`, `should_split_vertical()`
  - 12 new CJK-specific tests + 8 `is_cjk`/TextDirection tests (total: 53 tests in workspace)
- **Files changed:**
  - `crates/pdfplumber-core/src/text.rs` — TextDirection enum, is_cjk(), is_cjk_text(), 8 tests
  - `crates/pdfplumber-core/src/words.rs` — CJK tolerance logic, vertical text support, 12 CJK tests
  - `crates/pdfplumber-core/src/lib.rs` — re-export TextDirection, is_cjk, is_cjk_text
  - `crates/pdfplumber/src/lib.rs` — re-export new types from facade
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - CJK tolerance pattern: `last.bbox.width().max(base_tolerance)` — uses char width as minimum, falls back to configured tolerance
  - Vertical text sorting: (x0 descending, top ascending) — right-to-left columns, top-to-bottom within column
  - Vertical gap check: `y_gap = current.top - last.bottom` and `x_diff` for column detection
  - `is_some_and()` is cleaner than `map_or(false, ...)` for Option predicate checks
---

## 2026-02-28 - US-021: Graphics path operators - m, l, c, v, y, h, re
- **What was implemented:**
  - `Point` struct in `crates/pdfplumber-core/src/geometry.rs` — simple 2D point (x, y)
  - `Ctm` struct in `geometry.rs` — Current Transformation Matrix with identity, new, transform_point, concat methods
  - `PathSegment` enum in `crates/pdfplumber-core/src/path.rs` — MoveTo, LineTo, CurveTo, ClosePath
  - `Path` struct — collection of path segments
  - `PathBuilder` struct — builds paths from PDF operators with CTM transformation
  - All 7 PDF path operators: m (move_to), l (line_to), c (curve_to), v (curve_to_v), y (curve_to_y), h (close_path), re (rectangle)
  - All coordinates transformed through CTM before storage
  - 24 path tests + 10 geometry tests (Point/Ctm) = 34 new tests (total: 87 in workspace)
- **Files changed:**
  - `crates/pdfplumber-core/src/geometry.rs` — added Point, Ctm types + 10 tests
  - `crates/pdfplumber-core/src/path.rs` (new) — PathSegment, Path, PathBuilder + 24 tests
  - `crates/pdfplumber-core/src/lib.rs` — added path module, re-exports for Point, Ctm, Path, PathBuilder, PathSegment
  - `crates/pdfplumber/src/lib.rs` — re-export new types from facade
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - PathBuilder stores device-space (CTM-transformed) coordinates — current_point is always post-transform
  - `v` operator: cp1 = current_point (already transformed), cp2/end need CTM transform
  - `y` operator: cp2 = end point (both need CTM transform)
  - `re` operator delegates to move_to/line_to/close_path for consistent CTM handling
  - CTM concat: `a.concat(&b)` = `a × b` — used for cm operator in content stream
  - `subpath_start` tracks the most recent MoveTo for close_path to return to
- Painting operations consume PathBuilder segments via `take_and_reset()` and reset for next path
- `PaintedPath` captures path + stroke/fill flags + fill_rule + colors + line_width at painting time
---

## 2026-02-28 - US-022: Path painting operators - S, s, f, F, f*, B, B*, b, b*, n
- **What was implemented:**
  - `Color` struct (RGB, default black) in `crates/pdfplumber-core/src/painting.rs`
  - `FillRule` enum (NonZeroWinding default, EvenOdd) in `painting.rs`
  - `GraphicsState` struct (line_width, stroke_color, fill_color) in `painting.rs`
  - `PaintedPath` struct — path + stroke/fill flags + fill_rule + colors + line_width
  - Painting methods on `PathBuilder` (impl in `painting.rs`):
    - `stroke()` — S operator
    - `close_and_stroke()` — s operator (h then S)
    - `fill()` — f/F operator (nonzero winding)
    - `fill_even_odd()` — f* operator (even-odd rule)
    - `fill_and_stroke()` — B operator
    - `fill_even_odd_and_stroke()` — B* operator
    - `close_fill_and_stroke()` — b operator
    - `close_fill_even_odd_and_stroke()` — b* operator
    - `end_path()` — n operator (returns None, discards path)
  - `take_and_reset()` method on `PathBuilder` — consumes segments and resets for next path
  - 26 unit tests covering all operators, graphics state capture, path clearing, curves, CTM, sequential paints
- **Files changed:**
  - `crates/pdfplumber-core/src/painting.rs` (new) — Color, FillRule, GraphicsState, PaintedPath + painting methods + 26 tests
  - `crates/pdfplumber-core/src/path.rs` — added `take_and_reset()` method to PathBuilder
  - `crates/pdfplumber-core/src/lib.rs` — added painting module, re-exports
  - `crates/pdfplumber/src/lib.rs` — re-export new types from facade
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - Painting methods are impl'd on PathBuilder in a separate file (`painting.rs`) — Rust allows impl blocks across files within same crate
  - `take_and_reset()` uses `std::mem::take()` for efficient Vec drain — avoids clone, resets builder state
  - `close_and_stroke()` / `close_fill_*()` delegate to `close_path()` then the base paint method
  - `n` operator returns `Option<PaintedPath>` (None) — callers can use `if let Some(painted) = ...`
  - Clippy prefers `#[derive(Default)]` + `#[default]` attribute over manual `impl Default` for enums
---

## 2026-02-28 - US-023: Line and Rect extraction from paths
- **What was implemented:**
  - `LineOrientation` enum (Horizontal, Vertical, Diagonal) in `crates/pdfplumber-core/src/shapes.rs`
  - `Line` struct — x0, top, x1, bottom, line_width, stroke_color, orientation (top-left origin)
  - `Rect` struct — x0, top, x1, bottom, line_width, stroke/fill flags, stroke_color, fill_color + width()/height() methods
  - `extract_shapes(painted, page_height) -> (Vec<Line>, Vec<Rect>)` — main extraction function
  - Rectangle detection from axis-aligned closed 4-vertex paths (both `re` operator and manual construction)
  - Line extraction from LineTo segments in stroked paths with y-flip coordinate transformation
  - ClosePath generates closing line segment back to subpath start when needed
  - Handles multiple subpaths (rect + line in same painted path)
  - Curve subpaths produce neither lines nor rects (deferred to US-024)
  - 24 unit tests: horizontal/vertical/diagonal lines, rect from re, rect from 4-line path, fill+stroke rect, non-rect polygons, fill-only paths, multiple subpaths, CTM-transformed rect, edge cases
- **Files changed:**
  - `crates/pdfplumber-core/src/shapes.rs` (new) — Line, Rect, LineOrientation, extract_shapes + 24 tests
  - `crates/pdfplumber-core/src/lib.rs` — added shapes module, re-exports
  - `crates/pdfplumber/src/lib.rs` — re-export new types from facade
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - Subpath extraction: split segments at MoveTo boundaries for independent processing
  - Rectangle detection: collect vertices, check all 4 edges are axis-aligned (dx or dy < epsilon)
  - Fill-only non-rectangle paths produce no lines — only stroked paths generate Line objects
  - ClosePath must check start != current before generating a closing line (avoid zero-length lines)
  - `extract_subpaths()` returns slices to avoid cloning — efficient for large paths
---

## 2026-02-28 - US-024: Curve extraction + Edge derivation
- **What was implemented:**
  - `Curve` struct in `shapes.rs` — cubic Bezier with bbox (x0, top, x1, bottom), pts vec [(x,y);4], line_width, stroke/fill flags, colors
  - Extended `extract_shapes()` return type to `(Vec<Line>, Vec<Rect>, Vec<Curve>)` — 3-tuple
  - `extract_curves_from_subpath()` — handles subpaths with CurveTo segments, extracting Curve objects and Lines from mixed subpaths
  - `has_curves()` helper to detect subpaths requiring curve processing
  - Refactored line extraction into `push_line()` and `extract_lines_from_subpath()` helpers
  - `Edge` struct in `edges.rs` — x0, top, x1, bottom, orientation, source
  - `EdgeSource` enum — Line, RectTop, RectBottom, RectLeft, RectRight, Curve
  - `edge_from_line()` — direct Line → Edge conversion
  - `edges_from_rect()` — 4 edges per Rect (top, bottom, left, right)
  - `edge_from_curve()` — chord approximation (start→end line segment)
  - `derive_edges()` — combines edges from all sources
  - `Page::with_geometry()` constructor, `lines()/rects()/curves()/edges()` accessors
  - 30 new tests (8 curve, 17 edge, 5 Page) — total: 164 tests in workspace
- **Files changed:**
  - `crates/pdfplumber-core/src/shapes.rs` — Curve struct, extract_shapes returns 3-tuple, curve extraction logic, 8 new tests
  - `crates/pdfplumber-core/src/edges.rs` (new) — Edge, EdgeSource, derivation functions, 17 tests
  - `crates/pdfplumber-core/src/lib.rs` — added edges module, re-exports for Curve, Edge, EdgeSource, derive_edges
  - `crates/pdfplumber/src/lib.rs` — re-export new types from facade
  - `crates/pdfplumber/src/page.rs` — with_geometry(), geometry accessors, edges(), 5 new tests
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - Curve bbox is computed from all 4 control points (not tight bbox, but sufficient for most uses)
  - Chord approximation for curve→edge is simple and fast; De Casteljau subdivision can be added later if needed
  - Subpaths with curves may also contain LineTo segments — mixed extraction handles both
  - `has_curves()` check allows early branching between curve and line-only subpath processing
  - Page geometry (lines, rects, curves) stored alongside chars; edges computed on demand via derive_edges
---

## 2026-02-28 - US-025: Page::lines()/rects()/curves()/edges()/images() API
- **What was implemented:**
  - `Image` struct in `crates/pdfplumber-core/src/images.rs` — bbox (x0, top, x1, bottom), display width/height, name, src dimensions, bits_per_component, color_space
  - `ImageMetadata` struct (derive Default) — optional source metadata from PDF XObject dictionary
  - `image_from_ctm()` function — extracts Image from CTM active during Do operator by transforming unit square corners
  - `Image::bbox()` method — returns BBox from image coordinates
  - `Page::images() -> &[Image]` accessor in `crates/pdfplumber/src/page.rs`
  - `Page::with_geometry_and_images()` constructor — full page with chars, lines, rects, curves, and images
  - 8 unit tests for Image/image_from_ctm (core crate), 5 unit tests for Page images (facade crate)
  - 3 integration tests in `crates/pdfplumber/tests/page_api_integration.rs`: full page with all object types, typical PDF image placement, multiple images
  - Total: 180 tests in workspace (16 new)
- **Files changed:**
  - `crates/pdfplumber-core/src/images.rs` (new) — Image, ImageMetadata, image_from_ctm + 8 tests
  - `crates/pdfplumber-core/src/lib.rs` — added images module, re-exports
  - `crates/pdfplumber/src/lib.rs` — re-export Image, ImageMetadata, image_from_ctm from facade
  - `crates/pdfplumber/src/page.rs` — added images field, images() accessor, with_geometry_and_images() constructor + 5 tests
  - `crates/pdfplumber/tests/page_api_integration.rs` (new) — 3 integration tests
- **Dependencies added:** None (still pure Rust, zero dependencies)
- **Learnings for future iterations:**
  - Image XObjects occupy a 1×1 unit square; CTM maps this to display area on page
  - Image bbox: transform 4 corners of unit square through CTM, find min/max, y-flip
  - Clippy `too_many_arguments` triggered at 8 args — use `#[allow(clippy::too_many_arguments)]` for constructors that legitimately need all data
  - Clippy `derivable_impls` — always use `#[derive(Default)]` when all fields default to None/zero
  - Integration tests in `crates/<name>/tests/` directory — separate binary targets, test full public API
---

## 2026-02-28 - US-026: Standard encodings - WinAnsi, MacRoman, Differences array
- **What was implemented:**
  - `StandardEncoding` enum (WinAnsi, MacRoman, MacExpert, Standard) with `decode(u8)` and `decode_bytes(&[u8])` methods
  - WinAnsiEncoding: full 256-entry table (Windows code page 1252 superset, incl. Euro, curly quotes, dashes)
  - MacRomanEncoding: full 256-entry table (Classic Mac OS Roman, incl. fi/fl ligatures, math symbols)
  - MacExpertEncoding: expert glyph set (small caps in Adobe PUA, fractions, super/subscripts, old-style numerals)
  - StandardEncoding: Adobe standard Latin encoding (differs from ASCII at 0x27=quoteright, 0x60=quoteleft)
  - `FontEncoding` struct: 256-entry lookup table with Differences array override support
  - `FontEncoding::from_standard()`, `from_standard_with_differences()`, `from_table()`, `apply_differences()`
  - `EncodingResolver` with 3-level resolution: ToUnicode (HashMap<u16, String>) > font encoding > default encoding
  - `EncodingResolver::resolve(code: u16) -> Option<String>` and `decode_bytes(&[u8]) -> String`
  - 35 unit tests: each encoding's key characters, undefined codes, cross-encoding comparisons, Differences override, resolution chain
  - Total: 215 tests in workspace (35 new)
- **Files changed:**
  - `crates/pdfplumber-core/src/encoding.rs` (new) — StandardEncoding, FontEncoding, EncodingResolver + 35 tests
  - `crates/pdfplumber-core/src/lib.rs` — added encoding module, re-exports
  - `crates/pdfplumber/src/lib.rs` — re-export EncodingResolver, FontEncoding, StandardEncoding from facade
- **Dependencies added:** None (still pure Rust, zero external dependencies)
- **Learnings for future iterations:**
  - Encoding tables as `static [Option<char>; 256]` initialized in `const {}` blocks — zero runtime cost, no lazy_static needed
  - StandardEncoding 0x27 = curly right quote (U+2019), not ASCII apostrophe — common gotcha
  - MacExpert uses Adobe Private Use Area (U+F6xx–U+F7xx) for small caps — not standard Unicode
  - `HashMap<u16, String>` for ToUnicode allows multi-byte codes (CID fonts) and multi-char mappings (ligatures)
  - `cargo fmt` reformats trailing comment alignment — don't fight it, let rustfmt win
---

## 2026-02-28 - US-027: ExtGState (gs operator) - line width, dash pattern, opacity
- **What was implemented:**
  - `DashPattern` struct (dash_array, dash_phase) with solid(), is_solid(), Default
  - Extended `GraphicsState` with: dash_pattern (DashPattern), stroke_alpha (f64), fill_alpha (f64)
  - `ExtGState` struct with all-Optional fields: line_width, dash_pattern, stroke_alpha, fill_alpha, font
  - `GraphicsState::apply_ext_gstate(&mut self, ext: &ExtGState)` — applies only present fields
  - `GraphicsState::set_dash_pattern(array, phase)` — for `d` operator (inline dash pattern)
  - Extended `PaintedPath` with: dash_pattern, stroke_alpha, fill_alpha — captured from GraphicsState at paint time
  - Refactored painting methods: private `paint()` helper consolidates struct literal creation (was duplicated 9×)
  - 20 new tests: DashPattern (4), GraphicsState extensions (3), ExtGState (8), d operator (3), gs propagation (2)
  - Total: 240 tests in workspace (24 new including existing test updates)
- **Files changed:**
  - `crates/pdfplumber-core/src/painting.rs` — DashPattern, ExtGState, extended GraphicsState/PaintedPath, refactored paint(), 20 new tests
  - `crates/pdfplumber-core/src/shapes.rs` — updated test helpers for new GraphicsState/PaintedPath fields
  - `crates/pdfplumber-core/src/lib.rs` — re-export DashPattern, ExtGState
  - `crates/pdfplumber/src/lib.rs` — re-export DashPattern, ExtGState from facade
- **Dependencies added:** None (still pure Rust, zero external dependencies)
- **Learnings for future iterations:**
  - Private `paint()` helper method eliminates PaintedPath struct literal duplication across 9 painting operators
  - `..GraphicsState::default()` is essential when adding fields to avoid breaking existing struct construction
  - ExtGState uses all-Optional fields: callers read `ext.font` separately (not stored in GraphicsState, which is graphics-only)
  - `DashPattern::solid()` (empty array) is the PDF default — matches `[] 0 d`
---

## 2026-02-28 - US-028: extract_text(layout=true) - reading order with TextBlocks
- **What was implemented:**
  - `TextLine` struct (words + bbox) and `TextBlock` struct (lines + bbox) in `crates/pdfplumber-core/src/layout.rs`
  - `TextOptions` struct: layout (bool), y_tolerance, y_density, x_density with defaults (false, 3.0, 10.0, 10.0)
  - `cluster_words_into_lines()` — groups words by y-proximity (midpoint comparison)
  - `split_lines_at_columns()` — splits lines at large horizontal gaps (>x_density) for multi-column detection
  - `cluster_lines_into_blocks()` — x-overlap-aware clustering: lines must overlap block's x-range and be within y_density
  - `sort_blocks_reading_order()` — simple (top, x0) sort for natural reading order
  - `blocks_to_text()` — joins words with spaces, lines with \n, blocks with \n\n
  - `words_to_text()` — simple mode: cluster into lines then join with \n
  - `Page::extract_text(&TextOptions)` — dispatches to simple or layout mode
  - 31 unit tests in layout.rs (TextOptions, line clustering, block clustering, column splitting, reading order, end-to-end)
  - 6 unit tests in page.rs (simple mode, multiline, layout single column, two columns, mixed header/footer, empty)
  - Total: 253 tests in workspace (37 new)
- **Files changed:**
  - `crates/pdfplumber-core/src/layout.rs` (new) — TextLine, TextBlock, TextOptions, layout pipeline + 31 tests
  - `crates/pdfplumber-core/src/lib.rs` — added layout module, re-exports
  - `crates/pdfplumber/src/page.rs` — added extract_text() method + 6 tests
  - `crates/pdfplumber/src/lib.rs` — re-export TextBlock, TextLine, TextOptions, layout functions
- **Dependencies added:** None (still pure Rust, zero external dependencies)
- **Learnings for future iterations:**
  - Multi-column detection: split lines at large x-gaps BEFORE block clustering — lines from different columns get separated
  - x-overlap-aware block clustering prevents false merges: `has_x_overlap()` check ensures lines are horizontally aligned
  - Simple (top, x0) sorting handles both single-column and multi-column layouts naturally
  - Clippy `collapsible_if`: nested `if` inside `if` should be collapsed into single condition
  - Clippy `ptr_arg`: prefer `&mut [T]` over `&mut Vec<T>` for function parameters
---
