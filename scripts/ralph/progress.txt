## Codebase Patterns
- **HashMap bucketing for spatial clustering**: Use `HashMap<i64, Vec<usize>>` keyed by quantized coordinate `(value / bucket_size).floor() as i64` for O(1) spatial lookups. Check adjacent buckets (key±1) for boundary tolerance. Update bucket registration when the aggregate bbox changes.
- Char fields use `c.bbox.x0`, `c.bbox.top`, etc. (not `c.x0` directly)
- Word fields also use `w.bbox.x0`, etc.
- lopdf imports must be alphabetically ordered for cargo fmt: `use lopdf::{Document, Object, Stream, dictionary};`
- Test helpers: `fixtures_dir()`, `generated(name)`, `open_fixture(path)` pattern
- pdfplumber-py tests fail due to missing Python dylib — exclude with `--exclude pdfplumber-py`
- Rotation fixture `rotated_pages.pdf` has 4 pages (0°, 90°, 180°, 270°) generated by fpdf2 + pypdf
- Our implementation correctly normalizes rotated page coordinates — text extracts in proper reading order for all rotations
- Table detection works on rotated pages without modification — edges from content stream are transformed by PageGeometry
- `resolve_inherited()` in `lopdf_backend.rs` walks up page tree via /Parent; now also dereferences indirect references
- PDF page properties (MediaBox, CropBox, etc.) can be stored as indirect references (e.g., `/MediaBox 174 0 R`) — always dereference before calling `.as_array()`

---

# Ralph Progress Log - Issue #164: Fix parser failures on pr-136 and pr-138 PDFs
Started: 2026년  3월  1일 일요일 14시 50분 08초 KST
---
