## Codebase Patterns
- Color is an enum (Gray/Rgb/Cmyk/Other with f32 values), not a struct. Use `.clone()` since it doesn't implement Copy (due to Other(Vec<f32>)).
- Orientation enum lives in geometry.rs. LineOrientation in shapes.rs is a type alias for Orientation.
- All coordinates use f64. Color values use f32.
- BBox uses top-left origin: (x0, top, x1, bottom).
- Char has all PDF fields: text, bbox, fontname, size, doctop, upright, direction, stroking_color, non_stroking_color, ctm ([f64; 6]), char_code (u32).
- Word has doctop (min of char doctops) and direction (from first char).
- Line/Rect/Curve use top/bottom naming (not y0/y1) matching BBox convention.
- When constructing test Char instances, use a helper fn with sensible defaults for the 12 fields.
- PdfError (core) has manual Error impl; BackendError (parse) uses thiserror. Convert between them via From impls.
- ExtractResult<T> wraps value + warnings. Use ExtractResult::ok(val) for clean results.

# Ralph Progress Log
Started: 2026년  2월 28일 토요일 01시 07분 18초 KST
---

## 2026-02-28 - US-002
- What was implemented: Core data model types - Color enum (Gray/Rgb/Cmyk/Other), Orientation enum, zero-size BBox edge case test
- Files changed:
  - crates/pdfplumber-core/src/geometry.rs (added Orientation enum, zero-size BBox test)
  - crates/pdfplumber-core/src/painting.rs (Color struct -> enum with Gray/Rgb/Cmyk/Other variants)
  - crates/pdfplumber-core/src/shapes.rs (LineOrientation -> type alias for Orientation, clone Color)
  - crates/pdfplumber-core/src/edges.rs (use Orientation from geometry)
  - crates/pdfplumber-core/src/lib.rs (export Orientation)
  - crates/pdfplumber/src/lib.rs (re-export Orientation)
- Dependencies added: none
- **Learnings for future iterations:**
  - BBox, TextDirection, LineOrientation already existed in the codebase from Phase 2 work
  - Color was a simple RGB struct - changed to proper PDF color space enum
  - Color can't derive Copy due to Other(Vec<f32>) - need .clone() everywhere it was previously copied
  - Kept LineOrientation as type alias to avoid breaking existing code in pdfplumber crate
---

## 2026-02-28 - US-003
- What was implemented: Extended Char with doctop, upright, direction, stroking_color, non_stroking_color, ctm, char_code fields. Extended Word with doctop, direction. Added construction+field-access tests for Line, Rect, Curve, Edge, Image.
- Files changed:
  - crates/pdfplumber-core/src/text.rs (Char: added 7 new fields, new tests)
  - crates/pdfplumber-core/src/words.rs (Word: added doctop + direction, updated make_word, new tests)
  - crates/pdfplumber-core/src/shapes.rs (added construction tests for Line/Rect/Curve)
  - crates/pdfplumber-core/src/edges.rs (added construction tests for Edge/EdgeSource)
  - crates/pdfplumber-core/src/images.rs (added construction test for Image)
  - crates/pdfplumber-core/src/layout.rs (updated test helper for new Char/Word fields)
  - crates/pdfplumber/src/page.rs (updated test helper for new Char fields)
  - crates/pdfplumber/tests/page_api_integration.rs (updated test helper for new Char fields)
- Dependencies added: none
- **Learnings for future iterations:**
  - Most types already existed from Phase 2 work; US-003 mainly added missing fields to Char/Word
  - Char now has 12 fields - test helpers are essential to avoid verbose test code
  - Word::doctop is computed as min of constituent char doctops during extraction
  - Word::direction is taken from the first char's direction
  - ctm stored as [f64; 6] (not Ctm struct) for simplicity in the Char record
---

## 2026-02-28 - US-004
- What was implemented: Error and warning model - PdfError enum, ExtractWarning, ExtractResult<T>, ExtractOptions in pdfplumber-core. BackendError with thiserror in pdfplumber-parse.
- Files changed:
  - crates/pdfplumber-core/src/error.rs (new - PdfError, ExtractWarning, ExtractResult, ExtractOptions)
  - crates/pdfplumber-core/src/lib.rs (added error module + exports)
  - crates/pdfplumber-parse/src/error.rs (new - BackendError with thiserror)
  - crates/pdfplumber-parse/src/lib.rs (added error module + BackendError export)
  - crates/pdfplumber-parse/Cargo.toml (added thiserror = "2")
  - crates/pdfplumber/src/lib.rs (re-export PdfError, ExtractWarning, ExtractResult, ExtractOptions)
  - scripts/ralph/prd.json (marked US-004 passes: true)
- Dependencies added: thiserror 2 (in pdfplumber-parse only, as approved in PRD)
- **Learnings for future iterations:**
  - pdfplumber-core stays dependency-free: manual Display+Error impls for PdfError
  - PdfError uses String messages (not source errors) to stay Clone+PartialEq
  - From<std::io::Error> for PdfError converts via to_string() (loses original error, but keeps PdfError Clone-able)
  - BackendError in pdfplumber-parse bridges thiserror world with core PdfError
  - ExtractOptions defaults: 10 recursion depth, 100K objects/page, 100MB stream bytes, collect_warnings=true
  - ExtractResult<T>::map() preserves warnings when transforming values
---
