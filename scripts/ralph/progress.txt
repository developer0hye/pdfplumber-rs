## Codebase Patterns
- Workspace root Cargo.toml has `members` array for all crates
- Each crate uses `edition.workspace = true`, `rust-version.workspace = true`, `license.workspace = true`, `repository.workspace = true`
- Facade crate (`pdfplumber`) re-exports from `pdfplumber-core` and `pdfplumber-parse`
- Page API: `Pdf::open_file(path, None)`, `pdf.page(idx)`, `pdf.pages_iter()`, `pdf.page_count()`
- Page methods: `page.chars()`, `page.extract_words(opts)`, `page.extract_text(opts)`, `page.find_tables(settings)`
- Char fields: text, fontname, size, x0, top, x1, bottom, doctop, upright, direction
- Word fields: text, x0, top, x1, bottom, doctop, direction
- Table has `rows: Vec<Vec<Cell>>`, Cell has `text: Option<String>`
- Integration tests in `crates/pdfplumber/tests/` use real PDFs from `tests/fixtures/`
- CLI crate uses `assert_cmd` and `predicates` for integration tests
- CLI integration tests use `lopdf` + `tempfile` to create PDF fixtures on disk
- Page range parsing: `parse_page_range("1,3-5", page_count)` → 0-indexed `Vec<usize>`
- Text command pattern: `text_cmd::run(file, pages, format, layout) -> Result<(), i32>`
- Chars command pattern: `chars_cmd::run(file, pages, format) -> Result<(), i32>`
- Words command pattern: `words_cmd::run(file, pages, format, x_tolerance, y_tolerance) -> Result<(), i32>`
- Char bbox accessed via `ch.bbox.x0`, `ch.bbox.top`, etc. (BBox struct wraps coordinates)
- `page.chars()` returns `&[Char]` (reference to slice), iterate with `for ch in chars` not `&chars`
- Tables command pattern: `tables_cmd::run(file, pages, format, strategy, snap, join, text_tol) -> Result<(), i32>`
- `page.find_tables(&settings)` returns `Vec<Table>`, Table has `bbox`, `rows`, `cells`, `columns`
- Table.rows is `Vec<Vec<Cell>>`, Cell has `text: Option<String>` and `bbox: BBox`
- Strategy/TableSettings re-exported from pdfplumber facade crate
- Info command pattern: `info_cmd::run(file, pages, format) -> Result<(), i32>`
- Page dimension/count API: `page.width()`, `page.height()`, `page.rotation()`, `page.chars().len()`, `page.lines().len()`, `page.rects().len()`, `page.curves().len()`, `page.images().len()`
- Shared utilities in `shared.rs`: `open_pdf`, `resolve_pages`, `direction_str`, `csv_escape`, `ProgressReporter`
- ProgressReporter: `new(total)`, `report(current)`, `finish()` — only prints to stderr when TTY
- `Pdf` doesn't implement `Debug` — can't use `unwrap_err()` on `Result<Pdf, i32>`

# Ralph Progress Log
Started: 2026년  2월 28일 토요일 14시 03분 29초 KST
---

## 2026-02-28 - US-050
- Implemented CLI crate scaffolding with clap-based argument parsing
- Created `crates/pdfplumber-cli` with `[[bin]] name = "pdfplumber"`
- Added to workspace members in root Cargo.toml
- Defined CLI struct with 4 subcommands: Text, Chars, Words, Tables
- All subcommands accept positional FILE arg, --pages, --format options
- Text subcommand has extra --layout flag; TextFormat (text/json) vs OutputFormat (text/json/csv)
- 10 unit tests (clap parsing) + 7 integration tests (assert_cmd --help and error cases)
- Files changed: Cargo.toml, crates/pdfplumber-cli/{Cargo.toml, src/main.rs, src/cli.rs, tests/cli_args.rs}
- Dependencies added: clap (with derive), assert_cmd (dev), predicates (dev)
- **Learnings for future iterations:**
  - `assert_cmd::Command::cargo_bin` is deprecated in favor of `cargo::cargo_bin_cmd!` macro but still works
  - clap derive requires `#[command(subcommand)]` on the enum field and `#[derive(Subcommand)]` on the enum
  - Subcommand stubs use `eprintln!` + `std::process::exit(1)` for not-yet-implemented commands
---

## 2026-02-28 - US-051
- Implemented `text` subcommand for extracting text from PDF pages
- Files changed: crates/pdfplumber-cli/{Cargo.toml, src/main.rs, src/text_cmd.rs, src/page_range.rs, tests/text_cmd.rs}
- New modules: `text_cmd` (text extraction logic), `page_range` (page range parsing)
- Dependencies added: lopdf (dev), tempfile (dev) — for creating test fixture PDFs
- Features: text/json output formats, --pages filtering, --layout flag, error handling
- 8 unit tests (page_range) + 12 integration tests (text_cmd)
- **Learnings for future iterations:**
  - `page_range::parse_page_range` is reusable for all subcommands
  - Test PDF fixtures: use `lopdf` to create PDFs programmatically, `tempfile::NamedTempFile` to write to disk
  - Error pattern: return `Result<(), i32>` from subcommand handlers where i32 is the exit code
  - JSON output uses `serde_json::json!` macro with JSON Lines format (one JSON object per line)
---

## 2026-02-28 - US-052
- Implemented `chars` subcommand for extracting individual characters with coordinates
- Files changed: crates/pdfplumber-cli/{src/main.rs, src/chars_cmd.rs, tests/chars_cmd.rs}
- New module: `chars_cmd` (character extraction logic with text/json/csv output)
- No new dependencies
- Features: text (TSV), JSON, CSV output formats; --pages filtering; all Char fields in output
- 10 integration tests: text format, JSON validity/fields, CSV header/columns, page filtering, error handling
- **Learnings for future iterations:**
  - `page.chars()` returns `&[Char]`, not `Vec<Char>` — iterate directly, no extra `&`
  - BBox fields accessed via `ch.bbox.x0` etc., not directly on Char
  - TextDirection enum: Ltr, Rtl, Ttb, Btt — convert to lowercase string for output
  - JSON output uses array format (not JSON Lines) for chars — different from text subcommand
  - CSV header: `page,text,x0,top,x1,bottom,fontname,size` (8 columns)
---

## 2026-02-28 - US-053
- Implemented `words` subcommand for extracting words with bounding box coordinates
- Files changed: crates/pdfplumber-cli/{src/cli.rs, src/main.rs, src/words_cmd.rs, tests/words_cmd.rs}
- New module: `words_cmd` (word extraction logic with text/json/csv output)
- No new dependencies
- Features: text (TSV), JSON, CSV output formats; --pages filtering; --x-tolerance and --y-tolerance options
- Added 2 CLI parsing tests (tolerance options + defaults) + 11 integration tests
- **Learnings for future iterations:**
  - Words command pattern: `words_cmd::run(file, pages, format, x_tolerance, y_tolerance) -> Result<(), i32>`
  - `page.extract_words(&opts)` returns `Vec<Word>` (owned), iterate with `for w in &words`
  - Word fields: text, bbox (x0/top/x1/bottom), doctop, direction — no fontname/size (unlike Char)
  - CSV header: `page,text,x0,top,x1,bottom` (6 columns, fewer than chars)
  - Use struct init `WordOptions { x_tolerance, y_tolerance, ..WordOptions::default() }` to avoid clippy field_reassign_with_default
---

## 2026-02-28 - US-054
- Implemented `tables` subcommand for detecting and extracting tables from PDF pages
- Files changed: crates/pdfplumber-cli/{src/cli.rs, src/main.rs, src/tables_cmd.rs, tests/tables_cmd.rs}
- New module: `tables_cmd` (table detection + 3 output formats: grid/json/csv)
- Added `TableStrategy` enum to CLI (lattice/stream)
- Added CLI options: --strategy, --snap-tolerance, --join-tolerance, --text-tolerance
- No new dependencies
- Features: grid format with | separators and aligned columns, JSON with bbox/rows, CSV with tables separated by blank lines
- 2 CLI parsing tests (options + defaults) + 14 integration tests
- **Learnings for future iterations:**
  - Tables command pattern: `tables_cmd::run(file, pages, format, strategy, snap, join, text_tol) -> Result<(), i32>`
  - `page.find_tables(&settings)` returns `Vec<Table>`, Table has `bbox`, `rows`, `cells`, `columns`
  - Table.rows is `Vec<Vec<Cell>>`, Cell has `text: Option<String>` and `bbox: BBox`
  - Strategy and TableSettings are re-exported from pdfplumber facade crate
  - Grid format: compute column widths from cell text, pad with spaces, join with ` | ` separators
  - JSON output: array of table objects with page, bbox, and rows (2D array of optional strings)
  - CSV output: tables separated by blank lines, CSV escaping for commas/quotes/newlines
  - Summary line format: `--- Table N (page M, bbox: [x0, top, x1, bottom]) ---`
---

## 2026-02-28 - US-055
- Extracted duplicated utilities into new `shared.rs` module: `open_pdf`, `resolve_pages`, `direction_str`, `csv_escape`, `ProgressReporter`
- Refactored all 4 subcommands (text, chars, words, tables) to use shared module
- Added `ProgressReporter` struct: prints "Processing page N/M..." to stderr only when TTY
- Added 14 new page_range edge case tests: empty string, reversed range, single-page range, trailing comma, non-numeric input, range-with-non-numeric, page-0-in-range-start/end, range-end-exceeds, exact error messages, all-pages-via-range, overlapping-ranges-deduped
- Added 16 unit tests for shared module: direction_str (4), csv_escape (5), open_pdf (1), resolve_pages (3), progress_reporter (1), and 2 existing page_range exact-message tests
- Files changed: src/main.rs (added shared mod), src/shared.rs (new), src/page_range.rs (14 new tests), src/text_cmd.rs, src/chars_cmd.rs, src/words_cmd.rs, src/tables_cmd.rs (all refactored)
- No new dependencies
- **Learnings for future iterations:**
  - `Pdf` doesn't implement `Debug`, so can't use `unwrap_err()` on `Result<Pdf, i32>` — use pattern matching instead
  - Rust import ordering: rustfmt sorts identifiers alphabetically, so `ProgressReporter` comes before `direction_str`
  - `std::io::IsTerminal` trait provides `is_terminal()` method for TTY detection (stabilized in Rust 1.70)
  - Shared module pattern: extract common functions into `shared.rs`, import with `use crate::shared::{...}`
---

## 2026-02-28 - US-056
- Implemented `info` subcommand for displaying PDF metadata and page information
- Files changed: src/cli.rs (added Info variant + 4 CLI parsing tests), src/main.rs (wired info_cmd), src/info_cmd.rs (new), tests/info_cmd.rs (new)
- No new dependencies
- Features: text and JSON output formats, --pages filtering, per-page details (dimensions, rotation, object counts), total document summary (chars, tables)
- 4 CLI parsing tests + 17 integration tests (text output, JSON structure, page filtering, error handling)
- **Learnings for future iterations:**
  - Info command pattern: `info_cmd::run(file, pages, format) -> Result<(), i32>`
  - Page API: `page.width()`, `page.height()`, `page.rotation()` for dimensions; `.chars().len()`, `.lines().len()`, `.rects().len()`, `.curves().len()`, `.images().len()` for object counts
  - `page.find_tables(&settings).len()` for table count — reuses TableSettings::default()
  - Info uses `TextFormat` (text/json) from cli.rs — same as text subcommand, no CSV needed
  - JSON output uses `serde_json::to_string_pretty` for human-readable structured output (unlike JSON Lines in text cmd)
---
