## Codebase Patterns
- **PyO3 module name conflict**: The pymodule function name `pdfplumber` conflicts with the external crate name `pdfplumber`. Use `::pdfplumber` to reference the external crate in imports.
- **lopdf dictionary macro**: In Rust 2024 edition, `lopdf::dictionary!` macro requires explicit import: `use lopdf::dictionary;`
- **Test PDFs**: Create minimal PDFs programmatically using `lopdf::Document::with_version("1.7")` + manual page tree construction. See `crates/pdfplumber-py/src/lib.rs` tests for pattern.
- **AcroForm field tree**: Form fields live in `/AcroForm` dictionary (document catalog), not in page `/Annots`. Walk `/Fields` array recursively via `/Kids`. Field type `/FT` can be inherited from parent nodes. Terminal fields have no `/Kids` with `/T` entries.
- **Form field page association**: Use `/P` reference in field dictionary to map fields to pages. Not all fields have `/P`, so `page_index` is `Option<usize>`.
- **Workspace member addition**: Add new crates to root `Cargo.toml` `[workspace] members` array.
- **Crate lib naming**: When lib name differs from package name (e.g., `name = "pdfplumber"` in pdfplumber-py), use `[lib] name = "pdfplumber"` in Cargo.toml.
- **PyO3 extension-module feature**: Must be a Cargo feature flag, NOT a direct pyo3 dependency feature. Direct use prevents test linking. Use `features = ["extension-module"]` in `[features]` and activate via maturin's `pyproject.toml`.
- **PyO3 test setup**: Add `pyo3 = { version = "0.24", features = ["auto-initialize"] }` in `[dev-dependencies]` and add `"rlib"` to `crate-type` for test linking. Set `doctest = false` to avoid rlib name collision with the `pdfplumber` crate.
- **Rust→Python dict conversion**: Use `PyDict::new(py)` + `set_item()` for converting Rust structs to Python dicts. For `Option<T>`, use `py.None()` for the None case.
- **wasm-bindgen non-wasm targets**: `JsError::new()` panics on non-wasm targets ("cannot call wasm-bindgen imported functions"). Test error paths via underlying Rust API instead of through wasm-bindgen wrappers.
- **wasm-bindgen crate setup**: Use `crate-type = ["cdylib", "rlib"]` (cdylib for wasm-pack output, rlib for tests). Set `doctest = false` to avoid issues.
- **serde_wasm_bindgen**: Use `serde_wasm_bindgen::to_value()` for complex Rust→JsValue conversion. Enable `serde` feature on the pdfplumber dependency.
- **WASM pdfplumber dependency**: Use `default-features = false, features = ["serde"]` to disable filesystem APIs (`open_file`) and enable serialization.

---

# Ralph Progress Log - Phase 10: Interpreter Fixes - Path Operators, Extended Graphics State
Started: 2026년  3월  1일 일요일 02시 00분 49초 KST
---

## 2026-03-01 - US-086
- What was implemented: Wired path operators (m, l, c, v, y, h, re), painting operators (S, s, f, F, f*, B, B*, b, b*, n), clipping operators (W, W*), marked content operators (BMC/BDC/EMC) into the interpreter. Added dictionary parsing to tokenizer for inline dictionaries. Based on PR #121 cherry-pick with merge conflict resolution.
- Files changed:
  - `crates/pdfplumber-parse/src/interpreter.rs` — Added set_ctm() to path construction operators, replaced painting operators to use PathBuilder painting methods, new emit_path_event using PaintedPath, added marked content operator handling
  - `crates/pdfplumber-parse/src/tokenizer.rs` — Added Dictionary variant to Operand enum, replaced skip_dict with parse_dictionary/parse_dictionary_value functions, updated tests
  - `Cargo.lock` — Auto-updated
- Dependencies added: None
- **Learnings for future iterations:**
  - HEAD already had most of the pdf.rs/page.rs changes from prior PRs — cherry-pick conflicts were only in interpreter.rs and tokenizer.rs
  - The emit_path_event approach changed: old version took &mut PathBuilder and called take_and_reset(), new version takes PaintedPath from PathBuilder painting methods (stroke(), fill(), etc.)
  - The DashPattern import was no longer needed in interpreter.rs after switching to PaintedPath-based emit_path_event
  - `pdfplumber-py` tests fail with libpython3.11.dylib not found — pre-existing environment issue, not related to code changes
---
