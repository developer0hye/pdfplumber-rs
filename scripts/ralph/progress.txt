## Codebase Patterns

### CJK Encoding in CID Fonts
- Type0/CID fonts with predefined CMap encodings (GBK-EUC-H, ETen-B5-H, 90ms-RKSJ-H, etc.) use variable-length byte sequences
- The encoding name is in the Type0 font's `/Encoding` entry (not the CIDFont descendant)
- Without a `/ToUnicode` CMap, Unicode mapping requires decoding via the encoding (e.g., GBK bytes → Unicode)
- `encoding_rs` crate handles all common CJK encodings efficiently
- The CachedFont in interpreter.rs stores `cjk_encoding: Option<&'static encoding_rs::Encoding>` for runtime encoding detection

### Font Loading Pipeline
- `load_font_if_needed()` in interpreter.rs caches font info per resource name
- For Type0 fonts: detects CJK encoding, extracts CID metrics, ToUnicode CMap
- For simple fonts: extracts FontMetrics, /Encoding, ToUnicode CMap
- Unicode resolution chain: ToUnicode CMap → FontEncoding → CJK encoding → char::from_u32

### PDF Encryption Handling
- `open()` auto-decrypts PDFs with empty user password (matching Python pdfplumber behavior)
- lopdf 0.39 supports V=4/R=4 encryption (128-bit RC4 with crypt filters); 0.34 did not
- lopdf 0.39 changed `as_name_str()` → `as_name()` returning `&[u8]` instead of `&str`
- lopdf 0.39 `decrypt()` takes `&str`, `decrypt_raw()` takes `AsRef<[u8]>`
- lopdf 0.39 `save_to()` uses object streams by default — manual object encryption breaks roundtrip

### Content Stream Arrays
- `/Contents` can be: Reference→Stream, Reference→Array, or direct Array
- Always resolve references before checking type (don't assume Reference→Stream)

---

# Ralph Progress Log - Issue #165: Fix parser failure on 0-page PDF (issue-297-example)
Started: 2026년  3월  1일 일요일 15시 47분 53초 KST
---
