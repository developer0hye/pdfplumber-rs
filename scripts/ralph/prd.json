{
  "project": "pdfplumber-rs",
  "branchName": "ralph/phase2-words-geometry",
  "description": "Phase 2: Words & Geometry - Word grouping, path extraction, standard encodings, reading order",
  "userStories": [
    {
      "id": "US-018",
      "title": "WordExtractor - tolerance-based character grouping",
      "description": "Implement the word extraction algorithm that groups characters into words based on spatial proximity (x/y tolerance).",
      "acceptanceCriteria": [
        "WordOptions struct: x_tolerance, y_tolerance, keep_blank_chars, use_text_flow with pdfplumber-compatible defaults",
        "WordExtractor groups consecutive chars within x_tolerance horizontally and y_tolerance vertically",
        "Handles line breaks (chars on different lines become separate words)",
        "Handles spaces (configurable: split on space or include)",
        "Word.bbox is the union of constituent Char bboxes",
        "Unit tests: simple horizontal text, multi-line text, text with gaps, configurable tolerance",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implementation already existed from phase 1. All acceptance criteria verified."
    },
    {
      "id": "US-019",
      "title": "Page::extract_words() API + Word type integration",
      "description": "Wire WordExtractor into the public Page API so users can extract words from a page.",
      "acceptanceCriteria": [
        "Page::extract_words(options: WordOptions) -> Vec<Word>",
        "Words contain references to their constituent Chars",
        "Default WordOptions matches pdfplumber defaults (x_tolerance=3, y_tolerance=3)",
        "Integration test: extract words from a real PDF and verify text + bboxes",
        "Unit tests: extract words from page, verify word text concatenation, verify word bbox calculation",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implementation already existed from phase 1. All acceptance criteria verified."
    },
    {
      "id": "US-020",
      "title": "CJK word grouping - character-width-based tolerance",
      "description": "Enhance WordExtractor to handle CJK text where there are no spaces between characters. Use character-width-based tolerance scaling.",
      "acceptanceCriteria": [
        "Detect CJK characters by Unicode range (CJK Unified Ideographs, Hiragana, Katakana, Hangul, etc.)",
        "For CJK characters, use character width as the base tolerance (instead of fixed x_tolerance)",
        "Handle mixed CJK + Latin text in the same line",
        "Handle vertical writing mode (TextDirection::Ttb/Btt) for CJK",
        "Unit tests: Chinese text grouping, Japanese mixed text, Korean text, vertical text",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Graphics path operators - m, l, c, v, y, h, re",
      "description": "Implement path construction operators in the content stream interpreter: moveto, lineto, curveto, rectangle, closepath.",
      "acceptanceCriteria": [
        "PathBuilder tracks current path segments",
        "m (moveto): start new subpath",
        "l (lineto): straight line segment",
        "c (curveto): cubic Bezier curve (3 control points)",
        "v (curveto variant): cubic Bezier with first control point = current point",
        "y (curveto variant): cubic Bezier with last control point = endpoint",
        "h (closepath): close current subpath",
        "re (rectangle): append rectangle as 4 line segments",
        "All coordinates transformed through CTM",
        "Unit tests: each operator individually, combined path construction, CTM-transformed paths",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Path painting operators - S, s, f, F, f*, B, B*, b, b*, n",
      "description": "Implement path painting operators that determine how constructed paths are rendered (stroke, fill, or both).",
      "acceptanceCriteria": [
        "S (stroke): paint path outline using current stroking color and line width",
        "s (close + stroke): closepath then stroke",
        "f/F (fill): fill path using non-stroking color (nonzero winding)",
        "f* (fill even-odd): fill using even-odd rule",
        "B (fill + stroke): fill then stroke",
        "B* (fill even-odd + stroke)",
        "b (close + fill + stroke), b* (close + fill even-odd + stroke)",
        "n (end path, no painting): discard path (used for clipping)",
        "Each painting operation produces geometric objects (lines/rects/curves) with appropriate fill/stroke flags",
        "Unit tests: stroke-only path, fill-only path, both, clipping path (no output)",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Line and Rect extraction from paths",
      "description": "Convert painted paths into Line and Rect objects with proper coordinate transformation to top-left origin.",
      "acceptanceCriteria": [
        "Detect axis-aligned rectangles from re operator and 4-line closed paths",
        "Extract Line objects from straight path segments (lineto) with stroke width and color",
        "Convert coordinates to top-left origin (y-flip)",
        "Classify line orientation: Horizontal, Vertical, or Diagonal",
        "Rect includes fill/stroke flags and colors",
        "Handle line width from graphics state",
        "Unit tests: horizontal line, vertical line, rectangle from re, rectangle from path segments, line with custom width",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Curve extraction + Edge derivation",
      "description": "Extract Curve objects from Bezier paths and derive Edge objects from all geometric primitives (lines, rects, curves) for table detection.",
      "acceptanceCriteria": [
        "Curve struct populated from cubic Bezier path segments",
        "Edge derivation from Lines: direct conversion",
        "Edge derivation from Rects: 4 edges per rectangle (top, bottom, left, right)",
        "Edge derivation from Curves: approximate as line segments (chord or subdivision)",
        "Page::edges() returns combined edges from all sources with EdgeSource tracking",
        "Unit tests: curve extraction, edge from line, edges from rect, edge approximation from curve",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Page::lines()/rects()/curves()/edges()/images() API",
      "description": "Wire geometry extraction into the public Page API so all geometric objects and images are accessible.",
      "acceptanceCriteria": [
        "Page::lines() -> &[Line]",
        "Page::rects() -> &[Rect]",
        "Page::curves() -> &[Curve]",
        "Page::edges() -> Vec<Edge> (computed from lines + rects + curves)",
        "Page::images() -> &[Image] (bbox + metadata from XObject images)",
        "Image extraction from Do operator for Image XObjects (bbox from CTM)",
        "Integration test: PDF with lines, rectangles, and images",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Standard encodings - WinAnsi, MacRoman, Differences array",
      "description": "Implement standard PDF text encodings for fonts that don't have a ToUnicode CMap.",
      "acceptanceCriteria": [
        "WinAnsiEncoding: full 256-entry mapping to Unicode",
        "MacRomanEncoding: full 256-entry mapping to Unicode",
        "MacExpertEncoding: full mapping to Unicode",
        "StandardEncoding: full mapping to Unicode",
        "Handle /Encoding dictionary with /BaseEncoding + /Differences array",
        "Font encoding resolution order: ToUnicode > explicit Encoding > implicit/default",
        "Unit tests: each encoding with known character codes, Differences override, encoding fallback chain",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "ExtGState (gs operator) - line width, dash pattern, opacity",
      "description": "Implement the gs operator that applies Extended Graphics State parameters from the page resources.",
      "acceptanceCriteria": [
        "Parse gs operator: look up ExtGState dictionary from page resources",
        "Apply /LW (line width) to graphics state",
        "Apply /D (dash pattern) to graphics state",
        "Apply /CA and /ca (stroking/non-stroking alpha) to graphics state",
        "Apply /Font (font + size override) to text state if present",
        "Handle d operator (inline dash pattern setting)",
        "Unit tests: gs with line width, gs with dash pattern, gs with opacity, d operator",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Dash patterns affect table detection quality."
    },
    {
      "id": "US-028",
      "title": "extract_text(layout=true) - reading order with TextBlocks",
      "description": "Implement layout-aware text extraction that clusters characters into TextBlocks and orders them in natural reading order.",
      "acceptanceCriteria": [
        "TextBlock struct: list of lines (each a list of words), bbox",
        "Cluster words into lines based on y-proximity",
        "Cluster lines into blocks based on spatial proximity and alignment",
        "Sort blocks in reading order: top-to-bottom, left-to-right (for LTR text)",
        "Handle multi-column layouts by detecting column boundaries",
        "TextOptions struct with layout flag",
        "Page::extract_text(TextOptions { layout: true }) produces correctly ordered text",
        "Unit tests: single column text, two-column layout, mixed blocks, reading order verification",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "This is the capstone story for Phase 2 text features."
    }
  ]
}
