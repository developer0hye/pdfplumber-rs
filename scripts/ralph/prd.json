{
  "project": "pdfplumber-rs",
  "branchName": "ralph/phase6-feature-parity",
  "description": "Phase 6: Feature Parity - Metadata, annotations, bookmarks, search, dedup, unicode normalization, page boxes, filter",
  "userStories": [
    {
      "id": "US-058",
      "title": "PDF document metadata access",
      "description": "Extract document-level metadata from the PDF info dictionary (Title, Author, Subject, Keywords, Creator, Producer, CreationDate, ModDate). Nearly every PDF library provides this — it is basic expected functionality.",
      "acceptanceCriteria": [
        "DocumentMetadata struct with fields: title, author, subject, keywords, creator, producer, creation_date, mod_date (all Option<String>)",
        "Parse /Info dictionary from PDF trailer",
        "Handle date strings in PDF date format (D:YYYYMMDDHHmmSSOHH'mm')",
        "Pdf::metadata() -> &DocumentMetadata",
        "Add metadata to CLI `info` subcommand output (both text and JSON formats)",
        "Handle missing /Info dictionary gracefully (return empty metadata)",
        "Unit tests: PDF with full metadata, PDF with partial metadata, PDF with no /Info",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Add to pdfplumber-parse for extraction, expose via pdfplumber facade. Reference: pypdf PdfReader.metadata, PyMuPDF Document.metadata."
    },
    {
      "id": "US-059",
      "title": "Page box variants - TrimBox, BleedBox, ArtBox",
      "description": "Expose additional page box types beyond MediaBox and CropBox. Python pdfplumber added trimbox/bleedbox/artbox in v0.11.7. Important for print production workflows.",
      "acceptanceCriteria": [
        "Page::trim_box() -> Option<BBox>",
        "Page::bleed_box() -> Option<BBox>",
        "Page::art_box() -> Option<BBox>",
        "Parse /TrimBox, /BleedBox, /ArtBox from page dictionary (with inheritance)",
        "Add all page boxes to CLI `info` subcommand output",
        "Unit tests: page with all box types, page with only MediaBox, inheritance from parent",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Straightforward extension of existing page_media_box/page_crop_box pattern in lopdf backend."
    },
    {
      "id": "US-060",
      "title": "Annotation extraction",
      "description": "Extract PDF annotations from pages. Annotations contain critical information (comments, highlights, stamps, etc.) and are exposed by pdfplumber(Py), PyMuPDF, PDFBox, MuPDF, and HexaPDF.",
      "acceptanceCriteria": [
        "Annotation struct: annot_type (Text/Link/FreeText/Highlight/Underline/StrikeOut/Stamp/etc.), bbox, contents (Option<String>), author (Option<String>), date (Option<String>), raw_subtype (String)",
        "AnnotationType enum covering common annotation subtypes",
        "Parse /Annots array from page dictionary",
        "For each annotation: extract /Subtype, /Rect (bbox), /Contents, /T (author), /M (modification date)",
        "Page::annots() -> &[Annotation]",
        "Handle pages with no annotations (return empty slice)",
        "Unit tests: page with Text annotation, page with Highlight annotation, page with no annotations",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Add Annotation type to pdfplumber-core, parsing to pdfplumber-parse. Reference: pdfplumber(Py) Page.annots."
    },
    {
      "id": "US-061",
      "title": "Hyperlink extraction",
      "description": "Extract hyperlinks from pages as a filtered subset of Link annotations with resolved URI targets. Reference: pdfplumber(Py) Page.hyperlinks.",
      "acceptanceCriteria": [
        "Hyperlink struct: bbox (BBox), uri (String)",
        "Page::hyperlinks() -> Vec<Hyperlink>",
        "Filter annotations with /Subtype /Link",
        "Resolve /A (action) dictionary: extract /URI for URI actions, /D for GoTo destinations",
        "Handle /Dest (named destination) on Link annotations",
        "Handle annotations without actions gracefully (skip or return with empty URI)",
        "Add `annots` and `links` CLI subcommands with --format json/text/csv",
        "Unit tests: page with URI link, page with GoTo link, page with no links",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Depends on US-060 (annotation extraction)."
    },
    {
      "id": "US-062",
      "title": "Bookmark / Outline / ToC extraction",
      "description": "Extract the document outline tree (bookmarks/table of contents) from the PDF catalog. Supported by PyMuPDF, pdfminer, PDFBox, pdfcpu, HexaPDF. One of the most requested features in Python pdfplumber (#1319).",
      "acceptanceCriteria": [
        "Bookmark struct: title (String), level (usize, 0-indexed depth), page_number (Option<usize>, 0-indexed), dest_top (Option<f64>, y-coordinate on destination page)",
        "Pdf::bookmarks() -> Vec<Bookmark>",
        "Parse /Outlines from document catalog, walk the outline tree (/First, /Next, /Last links)",
        "Resolve /Dest or /A (GoTo action) to page number + coordinates",
        "Handle named destinations via /Dests or /Names dictionary",
        "Handle circular references in outline tree (max depth limit)",
        "Add `bookmarks` CLI subcommand with --format json/text",
        "Unit tests: PDF with multi-level bookmarks, PDF with no outlines, named destination resolution",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Parsing is in pdfplumber-parse, Bookmark type in pdfplumber-core, API in pdfplumber facade. Reference: PyMuPDF Document.get_toc()."
    },
    {
      "id": "US-063",
      "title": "Text search with position",
      "description": "Search for text patterns (regex or plain string) within a page and return matches with bounding boxes. Reference: pdfplumber(Py) Page.search().",
      "acceptanceCriteria": [
        "SearchMatch struct: text (String), bbox (BBox), page_number (usize), char_indices (Vec<usize>)",
        "Page::search(pattern, options) -> Vec<SearchMatch>",
        "SearchOptions: regex (bool, default true), case_sensitive (bool, default true)",
        "For regex patterns: use the `regex` crate",
        "Calculate match bbox as union of constituent character bboxes",
        "Handle matches spanning multiple words/lines",
        "Pdf::search_all(pattern, options) -> Vec<SearchMatch> for multi-page search",
        "Add `search` CLI subcommand: `pdfplumber search <FILE> <PATTERN> [--pages] [--case-insensitive] [--format json/text]`",
        "Unit tests: simple string search, regex search, case-insensitive, multi-word match bbox, no matches",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "The `regex` crate is a new dependency — justified as the standard Rust regex library. Add to pdfplumber-core or pdfplumber crate."
    },
    {
      "id": "US-064",
      "title": "Duplicate character deduplication",
      "description": "Remove duplicate overlapping characters that some PDF generators output (for bold effect or due to bugs). Reference: pdfplumber(Py) Page.dedupe_chars().",
      "acceptanceCriteria": [
        "DedupeOptions struct: tolerance (f64, default 1.0), extra_attrs (Vec<String>, default ['fontname', 'size'])",
        "Page::dedupe_chars(options) -> CroppedPage (or new page view with duplicates removed)",
        "Two chars are duplicates if: their bboxes overlap within tolerance AND extra_attrs match",
        "When duplicates found, keep the first occurrence, discard subsequent ones",
        "Deduplication does not modify the original page (returns a new view)",
        "Unit tests: overlapping identical chars deduped, non-overlapping chars preserved, different font chars not deduped",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Implement in pdfplumber-core as a character filter algorithm."
    },
    {
      "id": "US-065",
      "title": "Unicode normalization option",
      "description": "Apply Unicode normalization to extracted text. Different PDF generators produce different Unicode forms for the same visual text. Reference: pdfplumber(Py) unicode_norm parameter.",
      "acceptanceCriteria": [
        "UnicodeNorm enum: None, Nfc, Nfd, Nfkc, Nfkd",
        "Add unicode_norm field to ExtractOptions (default: None)",
        "When set, apply normalization to all extracted Char.text values during extraction",
        "Use the `unicode-normalization` crate",
        "Add --unicode-norm <NFC|NFD|NFKC|NFKD> flag to CLI text/chars/words subcommands",
        "Unit tests: text with composed vs decomposed characters, NFKC normalization of ligatures",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "The `unicode-normalization` crate is a new dependency — justified as the standard Rust unicode normalization library."
    },
    {
      "id": "US-066",
      "title": "Custom object filtering - filter() method",
      "description": "Add a filter() method that retains only objects matching a user-defined predicate, enabling custom filtering beyond bbox-based spatial operations. Reference: pdfplumber(Py) Page.filter().",
      "acceptanceCriteria": [
        "Page::filter<F>(predicate: F) -> FilteredPage where F: Fn(&PageObject) -> bool",
        "PageObject enum wrapping Char/Line/Rect/Curve/Image references",
        "FilteredPage supports same query methods as Page: chars(), lines(), rects(), curves(), images(), extract_words(), extract_text(), find_tables()",
        "Can chain: page.filter(f1).filter(f2) for composable filtering",
        "Unit tests: filter by font name, filter by color, filter by size, chained filters",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "May require refactoring CroppedPage and FilteredPage to share a common trait or use a unified page view abstraction."
    }
  ]
}
