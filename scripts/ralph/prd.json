{
  "project": "pdfplumber-rs",
  "branchName": "ralph/issue-166-rotation-handling",
  "description": "Issue #166: Fix rotation handling for 0% extraction on rotated PDFs",
  "relatedIssue": 166,
  "userStories": [
    {
      "id": "US-166-1",
      "title": "Implement page /Rotate coordinate transformation",
      "description": "nics-background-checks-2015-11-rotated.pdf produces 0% extraction accuracy while its non-rotated counterpart extracts at 100%. The /Rotate value on pages is not being applied to coordinate transformations, causing all bbox coordinates to mismatch the golden data. Implement proper handling of the /Rotate page attribute: when a page has /Rotate (90, 180, 270), the coordinate system must be transformed so that extracted character/word/line/rect bboxes match what Python pdfplumber produces. The transformation should be applied after content stream interpretation but before returning coordinates to the user.",
      "acceptanceCriteria": [
        "nics-background-checks-2015-11-rotated.pdf extracts chars with >90% F1 accuracy",
        "nics-background-checks-2015-11-rotated.pdf extracts words with >90% F1 accuracy",
        "Non-rotated nics-background-checks-2015-11.pdf remains unaffected (100%)",
        "Page dimensions (width/height) are swapped correctly for 90/270 rotation",
        "Unit tests for each rotation value (0, 90, 180, 270)",
        "No regression on existing tests: cargo test --workspace passes",
        "cargo fmt --all -- --check passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Key files: crates/pdfplumber/src/page.rs (Page API), crates/pdfplumber-parse/src/interpreter.rs (content stream interpreter). The /Rotate value is in the page dictionary and can be inherited from parent nodes in the page tree. Python pdfplumber applies rotation as a coordinate transform: 90° rotates (x,y) → (y, width-x), 180° → (width-x, height-y), 270° → (height-y, x). The page's MediaBox dimensions should also be adjusted (width↔height swap for 90°/270°). Check how lopdf exposes the /Rotate key."
    }
  ]
}
