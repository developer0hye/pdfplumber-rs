{
  "project": "pdfplumber-rs",
  "branchName": "ralph/issue-163-annotation-parse",
  "description": "Issue #163: Fix parser failures on annotation PDFs (annotations.pdf, rotated variants)",
  "relatedIssue": 163,
  "userStories": [
    {
      "id": "US-163-1",
      "title": "Diagnose and fix parse errors on annotations.pdf",
      "description": "The parser fails entirely on annotations.pdf, annotations-rotated-90.pdf, annotations-rotated-180.pdf, and annotations-rotated-270.pdf. Python pdfplumber extracts 14 chars and 3 words from annotations.pdf. Diagnose the parse error by attempting to open the PDF and examining the error message. The likely cause is that the parser encounters annotation-related objects or operators in the content stream that it doesn't handle. Fix the parser to gracefully handle or skip annotation data so that text extraction succeeds. Note: annotations-unicode-issues.pdf already works (100% accuracy), so compare its structure to find what differs.",
      "acceptanceCriteria": [
        "annotations.pdf opens without parse error",
        "annotations-rotated-90.pdf opens without parse error",
        "annotations-rotated-180.pdf opens without parse error",
        "annotations-rotated-270.pdf opens without parse error",
        "Text extraction from annotations.pdf produces chars (Python expects 14 chars, 3 words)",
        "No regression on annotations-unicode-issues.pdf (should remain 100%)",
        "No regression on existing tests: cargo test --workspace passes",
        "cargo fmt --all -- --check passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Test fixture PDFs are in tests/fixtures/pdfs/ (downloaded via full-fixtures feature). The test is in crates/pdfplumber/tests/real_world_cross_validation.rs (rw_annotations, rw_annotations_rotated_90, etc.). Compare the working annotations-unicode-issues.pdf structure with the failing annotations.pdf to find the difference. Common causes: unexpected dictionary keys, unsupported stream filters, or annotation appearance streams."
    }
  ]
}
