{
  "project": "pdfplumber-rs",
  "branchName": "ralph/phase5-cli",
  "description": "Phase 5: CLI - Command-line interface for pdfplumber-rs (separate crate)",
  "userStories": [
    {
      "id": "US-050",
      "title": "CLI crate scaffolding with clap",
      "description": "Create a new crate `pdfplumber-cli` in the workspace with clap-based argument parsing. Define the top-level command structure with subcommands: text, chars, words, tables. The binary name should be `pdfplumber`.",
      "acceptanceCriteria": [
        "New crate at crates/pdfplumber-cli with [[bin]] name = 'pdfplumber'",
        "Add pdfplumber-cli to workspace members in root Cargo.toml",
        "Dependencies: pdfplumber (path), clap (with derive feature), serde_json",
        "Top-level CLI struct with subcommands: Text, Chars, Words, Tables",
        "All subcommands accept a positional <FILE> argument (PDF path)",
        "Common options on all subcommands: --pages <RANGE> (e.g. '1,3-5', default: all), --format <FORMAT> (json/text/csv, varies by subcommand)",
        "Running `cargo run -p pdfplumber-cli -- --help` prints usage with all subcommands",
        "Running each subcommand with --help prints subcommand-specific usage",
        "cargo check --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "clap is a new dependency - justified as the standard Rust CLI framework."
    },
    {
      "id": "US-051",
      "title": "CLI 'text' subcommand - extract text from PDF",
      "description": "Implement the `text` subcommand that extracts text from PDF pages and outputs to stdout. Support layout mode and page selection.",
      "acceptanceCriteria": [
        "`pdfplumber text <file.pdf>` prints extracted text from all pages",
        "`pdfplumber text <file.pdf> --pages 1,3-5` prints text from selected pages only",
        "`pdfplumber text <file.pdf> --layout` uses layout=true mode for reading order",
        "`pdfplumber text <file.pdf> --format json` outputs {\"page\": N, \"text\": \"...\"} per page as JSON lines",
        "Page separators in text mode: '--- Page N ---' header between pages",
        "Proper error messages for: file not found, invalid PDF, invalid page range",
        "Exit code 0 on success, 1 on error",
        "Integration test: run CLI binary on a test fixture PDF and verify output",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-052",
      "title": "CLI 'chars' subcommand - extract characters with coordinates",
      "description": "Implement the `chars` subcommand that extracts individual characters with position, font, and size information.",
      "acceptanceCriteria": [
        "`pdfplumber chars <file.pdf>` outputs chars in default text format (one char per line with coordinates)",
        "`pdfplumber chars <file.pdf> --format json` outputs JSON array of char objects with all fields (text, fontname, size, bbox, etc.)",
        "`pdfplumber chars <file.pdf> --format csv` outputs CSV with columns: page,text,x0,top,x1,bottom,fontname,size",
        "--pages option works for page filtering",
        "JSON output includes all Char fields: text, fontname, size, x0, top, x1, bottom, doctop, upright, direction",
        "Default text format: tab-separated values for easy piping",
        "Integration test: verify JSON output is valid and contains expected fields",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-053",
      "title": "CLI 'words' subcommand - extract words with coordinates",
      "description": "Implement the `words` subcommand that extracts words with bounding box coordinates.",
      "acceptanceCriteria": [
        "`pdfplumber words <file.pdf>` outputs words in default text format",
        "`pdfplumber words <file.pdf> --format json` outputs JSON array of word objects",
        "`pdfplumber words <file.pdf> --format csv` outputs CSV with columns: page,text,x0,top,x1,bottom",
        "--pages option works for page filtering",
        "--x-tolerance <FLOAT> and --y-tolerance <FLOAT> options for word grouping customization",
        "JSON output includes: text, x0, top, x1, bottom, doctop, direction",
        "Default text format: tab-separated values",
        "Integration test: verify output format and word grouping",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-054",
      "title": "CLI 'tables' subcommand - extract tables from PDF",
      "description": "Implement the `tables` subcommand that detects and extracts tables from PDF pages.",
      "acceptanceCriteria": [
        "`pdfplumber tables <file.pdf>` outputs detected tables in human-readable grid format",
        "`pdfplumber tables <file.pdf> --format json` outputs JSON array of tables with cells and rows",
        "`pdfplumber tables <file.pdf> --format csv` outputs each table as CSV (tables separated by blank line)",
        "--pages option works for page filtering",
        "--strategy <lattice|stream> option (default: lattice)",
        "--snap-tolerance, --join-tolerance, --text-tolerance options for table detection tuning",
        "Grid format output: aligned columns with | separators for readability",
        "Report table count and bbox in a summary line before each table",
        "Integration test: verify table detection and output formatting",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-055",
      "title": "Page range parsing and shared utilities",
      "description": "Implement robust page range parsing and shared CLI utilities used across all subcommands.",
      "acceptanceCriteria": [
        "Parse page range strings: '1' (single), '1-5' (range), '1,3,5' (list), '1-3,7,10-12' (mixed)",
        "Page numbers are 1-indexed in CLI input, converted to 0-indexed internally",
        "Invalid ranges produce clear error messages: 'page 0 is invalid (pages start at 1)', 'page 99 exceeds document page count (5)'",
        "Shared output formatting: write_json(), write_csv(), write_text() helpers",
        "Shared PDF opening with user-friendly error messages",
        "Progress indicator for large PDFs: 'Processing page N/M...' on stderr (only when stderr is a TTY)",
        "Unit tests: page range parsing with all formats, edge cases (empty, reversed ranges, duplicates)",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "This story may retroactively refactor utilities extracted from earlier subcommand stories."
    },
    {
      "id": "US-056",
      "title": "CLI metadata and info subcommand",
      "description": "Add an `info` subcommand that displays PDF metadata and page information, useful for inspecting PDFs before extraction.",
      "acceptanceCriteria": [
        "`pdfplumber info <file.pdf>` prints: page count, per-page dimensions (width x height), rotation, object counts (chars, lines, rects, curves, images)",
        "`pdfplumber info <file.pdf> --format json` outputs structured JSON metadata",
        "--pages option filters which pages to show info for",
        "Object counts are computed lazily (only when requested page is processed)",
        "Include total document summary: total chars, total tables detected",
        "Integration test: verify info output against known fixture",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-057",
      "title": "CLI crates.io publishing preparation",
      "description": "Prepare pdfplumber-cli for crates.io publishing with proper metadata, README, and version alignment.",
      "acceptanceCriteria": [
        "Cargo.toml metadata: description, license (MIT OR Apache-2.0), repository, keywords [pdf, cli, table, text-extraction], categories [command-line-utilities]",
        "Version matches other workspace crates (0.1.0)",
        "Add version dependency on pdfplumber crate (version = \"0.1.0\", path = \"../pdfplumber\")",
        "README.md in crates/pdfplumber-cli/ with: installation (cargo install pdfplumber-cli), usage examples for each subcommand, output format examples",
        "cargo publish --dry-run -p pdfplumber-cli succeeds",
        "`pdfplumber --version` prints version number",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Final story - after this, the CLI is ready for publication."
    }
  ]
}
