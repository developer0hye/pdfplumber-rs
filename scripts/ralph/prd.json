{
  "project": "pdfplumber-rs",
  "branchName": "ralph/issue-153-unicode-nfc",
  "description": "Issue #153: Change default Unicode normalization to NFC and add for_llm() preset",
  "relatedIssue": 153,
  "userStories": [
    {
      "id": "US-153-1",
      "title": "Change UnicodeNorm default to Nfc and add for_llm() preset to ExtractOptions",
      "description": "In `crates/pdfplumber-core/src/unicode_norm.rs`, change the `#[default]` attribute on the `UnicodeNorm` enum from `None` to `Nfc`. Update the doc comment on the `None` variant to remove '(default)' and add '(default)' to the `Nfc` variant doc comment. Update the `unicode_norm_default_is_none` test to assert `UnicodeNorm::default() == UnicodeNorm::Nfc`. In `crates/pdfplumber-core/src/error.rs`, update the `ExtractOptions::default()` impl to set `unicode_norm: UnicodeNorm::Nfc` (was `UnicodeNorm::None`). Add a `pub fn for_llm() -> Self` constructor to `ExtractOptions` that returns options optimized for LLM consumption: `unicode_norm: UnicodeNorm::Nfc` plus current defaults for other fields. Update any tests that assert `UnicodeNorm::None` as the default. Fix all downstream code in pdfplumber-cli and pdfplumber that may need adjustment for the new default.",
      "acceptanceCriteria": [
        "UnicodeNorm::default() returns UnicodeNorm::Nfc",
        "#[default] attribute is on Nfc variant, not None",
        "ExtractOptions::default().unicode_norm == UnicodeNorm::Nfc",
        "ExtractOptions::for_llm() exists and returns options with unicode_norm: UnicodeNorm::Nfc",
        "All tests updated to reflect new default (no test expects UnicodeNorm::None as default)",
        "Doc comments updated: Nfc says '(default)', None does not",
        "cargo fmt --all -- --check passes",
        "cargo clippy --workspace -- -D warnings passes",
        "cargo test --workspace passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Key files: crates/pdfplumber-core/src/unicode_norm.rs (enum definition, line 17-29), crates/pdfplumber-core/src/error.rs (ExtractOptions default, line 219). Tests to update: unicode_norm.rs:91 (unicode_norm_default_is_none), error.rs:445 (assert_eq opts.unicode_norm UnicodeNorm::None), error.rs:455. The CLI already handles unicode_norm as Option<UnicodeNormArg> which overrides the default, so it should be unaffected. Check crates/pdfplumber/src/pdf.rs:478 where `UnicodeNorm::None` is used as a comparison â€” this is checking if normalization is not None, so it should use != pattern which still works."
    }
  ]
}
