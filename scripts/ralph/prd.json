{
  "project": "pdfplumber-rs",
  "branchName": "ralph/phase4-polish",
  "description": "Phase 4: Polish - CID fonts, spatial filtering, parallelization, WASM, benchmarks, release prep",
  "userStories": [
    {
      "id": "US-040",
      "title": "CID fonts - CID-to-GID mapping and predefined CMaps",
      "description": "Implement CID font support for CJK text extraction: CID-to-GID mapping, Adobe predefined CMaps (Adobe-Japan1, Adobe-GB1, Adobe-CNS1, Adobe-Korea1).",
      "acceptanceCriteria": [
        "Parse CIDFont dictionaries (Type0 + CIDFontType0/CIDFontType2)",
        "Handle CIDToGIDMap: /Identity and explicit mapping stream",
        "Implement predefined CMap parsing: Adobe-Japan1-*, Adobe-GB1-*, Adobe-CNS1-*, Adobe-Korea1-*",
        "Handle /W (width) array for CID fonts (variable-width entries)",
        "Handle /DW (default width) for CID fonts",
        "Unit tests: CID font width lookup, predefined CMap mapping, Identity CIDToGIDMap",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Critical for CJK PDF support."
    },
    {
      "id": "US-041",
      "title": "CID fonts - Identity-H/V and subset font handling",
      "description": "Support Identity-H and Identity-V CMaps for CID fonts, and handle subset fonts (6-char prefix in font name).",
      "acceptanceCriteria": [
        "Identity-H: horizontal writing mode, CID = character code directly",
        "Identity-V: vertical writing mode, CID = character code directly",
        "Detect subset fonts by 6-uppercase-letter prefix + '+' in font name (e.g., ABCDEF+ArialMT)",
        "Strip subset prefix for font name normalization",
        "Handle 2-byte character codes for CID fonts in text operators",
        "Integration test with a CJK PDF fixture",
        "Unit tests: Identity-H mapping, Identity-V with vertical metrics, subset font name handling",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-042",
      "title": "Spatial filtering - crop, within_bbox, outside_bbox",
      "description": "Implement spatial filtering methods on Page that return filtered views of page objects within or outside a specified bounding box.",
      "acceptanceCriteria": [
        "Page::crop(bbox) -> CroppedPage: returns a view with only objects whose centers fall within bbox",
        "Page::within_bbox(bbox) -> CroppedPage: returns objects fully contained within bbox",
        "Page::outside_bbox(bbox) -> CroppedPage: returns objects fully outside bbox",
        "CroppedPage implements the same query methods as Page: chars(), lines(), rects(), edges(), extract_words(), extract_text(), find_tables()",
        "Coordinate adjustment: cropped page adjusts coordinates relative to crop origin",
        "Unit tests: crop with chars inside/outside, within_bbox strict containment, outside_bbox exclusion, chained filtering",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-043",
      "title": "serde serialization for all data types",
      "description": "Add optional serde Serialize/Deserialize implementations for all public data types behind a 'serde' feature flag.",
      "acceptanceCriteria": [
        "Feature flag 'serde' in pdfplumber-core and pdfplumber Cargo.toml",
        "Conditional #[cfg_attr(feature = \"serde\", derive(Serialize, Deserialize))] on: BBox, Char, Word, Line, Rect, Curve, Edge, Image, Table, Cell, Color, TextDirection, Orientation",
        "serde and serde_json as optional dependencies",
        "JSON round-trip test: serialize Char → JSON → deserialize, verify equality",
        "Unit tests: serialize each type to JSON, deserialize back, verify all fields",
        "cargo test --workspace passes",
        "cargo test --workspace --features serde passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-044",
      "title": "rayon parallel page processing",
      "description": "Add optional rayon-based parallel page processing behind a 'parallel' feature flag.",
      "acceptanceCriteria": [
        "Feature flag 'parallel' in pdfplumber Cargo.toml",
        "Pdf::pages_parallel() -> Vec<Result<Page, PdfError>> processes all pages concurrently",
        "rayon as optional dependency (behind 'parallel' feature)",
        "Non-parallel code path unchanged when feature is disabled",
        "Thread-safe: ensure all shared state is Send + Sync",
        "Unit tests: parallel extraction produces same results as sequential",
        "Benchmark: measure speedup on multi-page PDF",
        "cargo test --workspace passes",
        "cargo test --workspace --features parallel passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-045",
      "title": "Comprehensive error/warning model refinement",
      "description": "Refine the error and warning model based on real-world usage patterns from previous phases. Ensure best-effort extraction never panics.",
      "acceptanceCriteria": [
        "Review all Result/unwrap/expect usage across the codebase - replace panics with proper error handling",
        "Ensure ExtractWarning captures enough context: page number, operator index, font name, etc.",
        "Warning collection is optional (controlled by ExtractOptions.collect_warnings)",
        "Warnings don't affect output correctness - they're purely informational",
        "Add Display impl for all error/warning types with clear messages",
        "Unit tests: various error scenarios produce appropriate error types, warning collection on/off",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-046",
      "title": "Page-level memory management strategy",
      "description": "Implement page-level processing that doesn't require loading all pages into memory simultaneously.",
      "acceptanceCriteria": [
        "Pdf::page(index) processes page on-demand (not pre-computed at open time)",
        "Page data is not retained after Page is dropped (or uses weak references)",
        "Pdf::pages_iter() -> impl Iterator<Item = Result<Page, PdfError>> for streaming access",
        "Memory usage stays bounded when iterating over a large document",
        "Document metadata (page count, etc.) available without processing all pages",
        "Unit tests: verify page independence, iterator behavior, memory pattern (no accumulation)",
        "cargo test --workspace passes",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-047",
      "title": "WASM build support",
      "description": "Ensure the library compiles for wasm32-unknown-unknown target with a bytes-based API.",
      "acceptanceCriteria": [
        "cargo check --target wasm32-unknown-unknown passes for pdfplumber-core",
        "cargo check --target wasm32-unknown-unknown passes for pdfplumber (with appropriate feature flags)",
        "No std::fs, std::time::Instant, or other WASM-incompatible APIs in the default build",
        "File-path-based API behind a 'std' feature flag (enabled by default, disabled for WASM)",
        "Bytes-based API (Pdf::open(bytes)) works in all environments",
        "Document WASM usage in crate-level docs",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "May need to gate certain features behind cfg."
    },
    {
      "id": "US-048",
      "title": "Performance benchmarks vs Python pdfplumber",
      "description": "Create benchmarks comparing pdfplumber-rs against Python pdfplumber on representative PDFs.",
      "acceptanceCriteria": [
        "Benchmark suite using criterion crate in benches/ directory",
        "Benchmarks: char extraction, word extraction, text extraction, table detection (lattice), table detection (stream)",
        "Test PDFs: simple (1-page), medium (10-page), complex (tables + images + multi-font)",
        "Document baseline Python pdfplumber numbers in benchmark README",
        "Target: 5x+ faster on text extraction, 3x+ faster on table detection",
        "cargo bench compiles and runs",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "criterion is an additional dependency for benchmarks only (dev-dependency)."
    },
    {
      "id": "US-049",
      "title": "API documentation and crates.io release preparation",
      "description": "Complete API documentation, README, examples, and metadata for crates.io publication.",
      "acceptanceCriteria": [
        "All public types and functions have doc comments with examples",
        "Crate-level documentation (//! comments) in each lib.rs with overview and quick-start",
        "README.md with: project description, installation, quick start example, feature flags, MSRV, license",
        "examples/ directory with at least 3 examples: extract_text.rs, extract_table.rs, extract_chars.rs",
        "Cargo.toml metadata: description, license, repository, keywords, categories",
        "cargo doc --workspace --no-deps builds without warnings",
        "#![deny(missing_docs)] in all crate lib.rs files",
        "cargo clippy --workspace -- -D warnings passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Final story - after this, the library is ready for v1.0 release."
    }
  ]
}
